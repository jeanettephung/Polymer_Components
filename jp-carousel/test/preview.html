<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>Preview test</title>

    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/wct-browser-legacy/browser.js"></script>

    <script type="module" src="../jp-carousel.js"></script>
  </head>
  <body>
    
    <test-fixture id="Default">
      <template>
        <jp-carousel data='[
          {"src": "https://thumbs.dreamstime.com/b/male-crowntail-betta-fish-isolated-black-background-beautiful-blue-77203959.jpg", "caption": "A blue betta"},
          {"src": "https://upload.wikimedia.org/wikipedia/commons/4/42/Betta_splendens_male_crowntail.png", "caption": "A blue-red betta"},
          {"src": "https://cdn.idropnews.com/wp-content/uploads/2017/03/23164924/Beta-Fish-Wallpaper-Chevanon-Photography-1000x600.jpg", "caption": "A red betta"},
          {"src": "https://thumbs.dreamstime.com/b/blue-crowntail-betta-fish-siamese-fighting-fish-black-background-71712481.jpg", "caption": "A blue betta"},
          {"src": "https://thumbs.dreamstime.com/b/red-blue-siamese-fighting-fish-betta-fish-isolated-black-background-58695275.jpg", "caption": "A red-white betta"},
          {"src": "http://fishkeepingadvice.com/wp-content/uploads/siamese-fighting-fish.jpg", "caption": "A blue-purple betta"},
          {"src": "https://static.seattletimes.com/wp-content/uploads/2016/11/66ae45dc30524386bf08aee8a751b279-780x532.jpg", "caption": "A red-white-blue betta"},
          {"src": "https://media.istockphoto.com/photos/white-yellow-siamese-fighting-fish-picture-id601925038?k=6&m=601925038&s=612x612&w=0&h=pOtNyPfF6pEgm_x8Qi1flpLKmJ1tcbOhnEsZ97BO8wE=", "caption": "A yellow-white betta"},
          {"src": "http://www.fubiz.net/wp-content/uploads/2013/11/Stunning-Portraits-of-Fish-1.jpg", "caption": "A white betta"},
          {"src": "https://i.pinimg.com/736x/41/f3/ea/41f3eaba447b068d04f27f88f85d8e05--tropical-animals-tropical-fish.jpg", "caption": "A white-red betta"}
        ]'></jp-carousel>
      </template>
    </test-fixture>
    
    <test-fixture id="Preview">
      <template>
        <jp-carousel preview data='[
          {"src": "https://thumbs.dreamstime.com/b/male-crowntail-betta-fish-isolated-black-background-beautiful-blue-77203959.jpg", "caption": "A blue betta"},
          {"src": "https://upload.wikimedia.org/wikipedia/commons/4/42/Betta_splendens_male_crowntail.png", "caption": "A blue-red betta"},
          {"src": "https://cdn.idropnews.com/wp-content/uploads/2017/03/23164924/Beta-Fish-Wallpaper-Chevanon-Photography-1000x600.jpg", "caption": "A red betta"},
          {"src": "https://thumbs.dreamstime.com/b/blue-crowntail-betta-fish-siamese-fighting-fish-black-background-71712481.jpg", "caption": "A blue betta"},
          {"src": "https://thumbs.dreamstime.com/b/red-blue-siamese-fighting-fish-betta-fish-isolated-black-background-58695275.jpg", "caption": "A red-white betta"},
          {"src": "http://fishkeepingadvice.com/wp-content/uploads/siamese-fighting-fish.jpg", "caption": "A blue-purple betta"},
          {"src": "https://static.seattletimes.com/wp-content/uploads/2016/11/66ae45dc30524386bf08aee8a751b279-780x532.jpg", "caption": "A red-white-blue betta"},
          {"src": "https://media.istockphoto.com/photos/white-yellow-siamese-fighting-fish-picture-id601925038?k=6&m=601925038&s=612x612&w=0&h=pOtNyPfF6pEgm_x8Qi1flpLKmJ1tcbOhnEsZ97BO8wE=", "caption": "A yellow-white betta"},
          {"src": "http://www.fubiz.net/wp-content/uploads/2013/11/Stunning-Portraits-of-Fish-1.jpg", "caption": "A white betta"},
          {"src": "https://i.pinimg.com/736x/41/f3/ea/41f3eaba447b068d04f27f88f85d8e05--tropical-animals-tropical-fish.jpg", "caption": "A white-red betta"}
        ]'></jp-carousel>
      </template>
    </test-fixture>
    
    <test-fixture id="ActPreview">
      <template>
        <jp-carousel act-preview data='[
          {"src": "https://thumbs.dreamstime.com/b/male-crowntail-betta-fish-isolated-black-background-beautiful-blue-77203959.jpg", "caption": "A blue betta"},
          {"src": "https://upload.wikimedia.org/wikipedia/commons/4/42/Betta_splendens_male_crowntail.png", "caption": "A blue-red betta"},
          {"src": "https://cdn.idropnews.com/wp-content/uploads/2017/03/23164924/Beta-Fish-Wallpaper-Chevanon-Photography-1000x600.jpg", "caption": "A red betta"},
          {"src": "https://thumbs.dreamstime.com/b/blue-crowntail-betta-fish-siamese-fighting-fish-black-background-71712481.jpg", "caption": "A blue betta"},
          {"src": "https://thumbs.dreamstime.com/b/red-blue-siamese-fighting-fish-betta-fish-isolated-black-background-58695275.jpg", "caption": "A red-white betta"},
          {"src": "http://fishkeepingadvice.com/wp-content/uploads/siamese-fighting-fish.jpg", "caption": "A blue-purple betta"},
          {"src": "https://static.seattletimes.com/wp-content/uploads/2016/11/66ae45dc30524386bf08aee8a751b279-780x532.jpg", "caption": "A red-white-blue betta"},
          {"src": "https://media.istockphoto.com/photos/white-yellow-siamese-fighting-fish-picture-id601925038?k=6&m=601925038&s=612x612&w=0&h=pOtNyPfF6pEgm_x8Qi1flpLKmJ1tcbOhnEsZ97BO8wE=", "caption": "A yellow-white betta"},
          {"src": "http://www.fubiz.net/wp-content/uploads/2013/11/Stunning-Portraits-of-Fish-1.jpg", "caption": "A white betta"},
          {"src": "https://i.pinimg.com/736x/41/f3/ea/41f3eaba447b068d04f27f88f85d8e05--tropical-animals-tropical-fish.jpg", "caption": "A white-red betta"}
        ]'></jp-carousel>
      </template>
    </test-fixture>

    <script>
      function getPreview(element) {
        const style = window.getComputedStyle(element.$.previewImg, null);
        const opacity = style.getPropertyValue('opacity');
        if (opacity == 1) return (element.$.previewImg).getAttribute('src');
        else return -1;
      }
      
      suite('jp-carousel', () => {

        test('No preview => no preview on clicking left, middle, or right', () => {
          const el = fixture('Default');
          const shadow = el.shadowRoot;
          const rightBtn = shadow.getElementById('rightButton');
          const leftBtn = shadow.getElementById('leftButton');
          const previewBtn = shadow.getElementById('previewButton');

          var retval = getPreview(el);
          assert.equal(retval, -1);
          
          previewBtn.click();
          retval = getPreview(el);
          assert.equal(retval, -1);
          
          rightBtn.click();
          retval = getPreview(el);
          assert.equal(retval, -1);
          
          leftBtn.click();
          retval = getPreview(el);
          assert.equal(retval, -1);
        });
        
        test('Preview => preview on clicking in the middle, during navigating, and close when click on preview', (done) => {
          const el = fixture('Preview');
          const shadow = el.shadowRoot;
          const rightBtn = shadow.getElementById('rightButton');
          const leftBtn = shadow.getElementById('leftButton');
          const previewBtn = shadow.getElementById('previewButton');
          const closeBtn = shadow.getElementById('previewImg');
          
          var retval = getPreview(el);
          assert.equal(retval, -1);

          previewBtn.click();
          setTimeout(function() {
            retval = getPreview(el);
            var preview = (el.querySelector('.active')).getAttribute('src');
            assert.equal(retval, preview);
            
            rightBtn.click();
            retval = getPreview(el);
            preview = (el.querySelector('.active')).getAttribute('src');
            assert.equal(retval, preview);

            leftBtn.click();
            retval = getPreview(el);
            preview = (el.querySelector('.active')).getAttribute('src');
            assert.equal(retval, preview);

            closeBtn.click();
            setTimeout(function() {
              retval = getPreview(el);
              assert.equal(retval, -1);
            }, 500);
            done();
          }, 1000);
          
        });
        
        test('Act-Preview => displays preview on default', (done) => {
          const el = fixture('ActPreview');
          const shadow = el.shadowRoot;
          const rightBtn = shadow.getElementById('rightButton');
          const leftBtn = shadow.getElementById('leftButton');
          const previewBtn = shadow.getElementById('previewBtn');
          const closeBtn = shadow.getElementById('previewImg');

          var retval = getPreview(el);
          var preview = (el.querySelector('.active')).getAttribute('src');
          assert.equal(retval, preview);
          
          rightBtn.click();
          retval = getPreview(el);
          preview = (el.querySelector('.active')).getAttribute('src');
          assert.equal(retval, preview);
          
          leftBtn.click();
          retval = getPreview(el);
          preview = (el.querySelector('.active')).getAttribute('src');
          assert.equal(retval, preview);
          
          closeBtn.click();
          
          setTimeout(function() {
            retval = getPreview(el);
            assert.equal(retval, -1);
            done();
          }, 500);
        });
        
      });
    </script>

  </body>
</html>
